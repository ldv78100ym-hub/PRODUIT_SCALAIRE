<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours et Exercices Dynamiques : Le Produit Scalaire</title>
    <style>
        /* --- CSS EXISTANT (Cours) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px auto;
            max-width: 950px;
            padding: 30px;
            border: 1px solid #ccc;
            line-height: 1.6;
            color: #333;
            background-color: #fcfcfc;
        }

        .header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #0056b3;
            font-weight: bold;
        }

        .main-title {
            text-align: center;
            font-size: 2.5em;
            color: #0056b3;
            margin-top: 0;
            padding-bottom: 15px;
            border-bottom: 3px solid #0056b3;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        h2 { font-size: 1.6em; color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-top: 40px; }
        h3 { font-size: 1.3em; color: #555; margin-top: 20px; }

        .math-display {
            display: block;
            overflow-x: auto;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px dashed #ced4da;
            border-radius: 8px;
            font-size: 1.2em;
        }

        .exercice-bloc {
            background-color: #fff;
            border-left: 6px solid #007bff;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-radius: 0 5px 5px 0;
        }
        .niveau-titre { font-size: 1.1em; font-weight: bold; color: #28a745; margin-top: 0; }
        .solution-bloc { 
            background-color: #e8f5e9; padding: 15px; border: 1px solid #c8e6c9; 
            border-radius: 5px; margin-top: 15px; display: none; 
        }
        .document-analyse {
            background-color: #fdfdfe; font-style: italic; color: #555;
            border: 1px solid #e0e0e0; border-left: 4px solid #6c757d;
            padding: 15px; margin: 15px 0;
        }

        .btn-action {
            padding: 10px 20px; margin-top: 10px; cursor: pointer; border: none;
            border-radius: 4px; font-weight: 600; font-size: 0.95em; transition: background 0.3s;
        }
        .btn-relance { background-color: #007bff; color: white; margin-bottom: 20px; width: 100%; font-size: 1.1em; }
        .btn-relance:hover { background-color: #0056b3; }
        .btn-solution { background-color: #ffc107; color: #333; margin-right: 10px; }
        .btn-solution:hover { background-color: #e0a800; }
        .btn-reset-ex { background-color: #17a2b8; color: white; margin-right: 10px; }
        .btn-reset-ex:hover { background-color: #138496; }

        .data-table { width: 100%; border-collapse: collapse; margin: 15px 0; text-align: center; }
        .data-table th, .data-table td { border: 1px solid #dee2e6; padding: 10px; }
        .data-table th { background-color: #e9ecef; color: #495057; }

        .canvas-container { text-align: center; margin: 20px auto; }
        canvas { background-color: #fff; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .remarque { margin-top: 15px; padding: 10px 15px; border-left: 4px solid #ffc107; background-color: #fffbf2; font-style: italic; color: #666; }

        /* --- NOUVEAU CSS : MODALE DROITS D'AUTEUR --- */
        .footer-actions {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
        }
        
        #copyright-btn {
            background-color: #ffc107; /* Couleur jaune copyright */
            color: #343a40;
            margin: 0 auto;
        }

        .modal {
            display: none; 
            position: fixed; z-index: 1000; 
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.6); 
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; 
            padding: 30px;
            border: 1px solid #888;
            width: 80%; 
            max-width: 700px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-family: 'Segoe UI', sans-serif;
            text-align: left;
        }
        
        .close-btn {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
            transition: color 0.2s;
        }
        .close-btn:hover, .close-btn:focus {
            color: #000; text-decoration: none; cursor: pointer;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Modal */
        @media (max-width: 768px) {
            .modal-content { margin: 15% auto; width: 90%; padding: 20px; }
        }
        @media print {
            .footer-actions, .btn-action, .modal { display: none !important; }
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']], 
                displayMath: [['\\[', '\\]']] 
            }
        };
    </script>
</head>
<body>

    <div class="header">
        <span>Cours : Produit Scalaire</span>
        <span>1<sup>re</sup> STI2D / STL</span>
    </div>

    <h1 class="main-title">Le Produit Scalaire : Un Outil Puissant</h1>
    
    <button class="btn-action btn-relance" onclick="generateAllExercises()">üîÑ Relancer TOUS les exercices</button>

    <p>Le produit scalaire est une op√©ration math√©matique qui prend deux vecteurs et donne un <strong>nombre</strong> (un scalaire). Ce nombre est essentiel car il lie la <strong>longueur</strong> des vecteurs et l'<strong>angle</strong> qu'ils forment.</p>

    <h2>D√©finition G√©om√©trique : L'Essence de l'Angle</h2>
    
    <div class="canvas-container">
        <canvas id="canvas_cours_geo" width="400" height="200"></canvas>
    </div>

    <h3>Formule du Produit Scalaire</h3>
    <p>Le produit scalaire de deux vecteurs non nuls \(\vec{u}\) et \(\vec{v}\) est d√©fini par la formule :</p>
    <div class="math-display">
        \[\vec{u} \cdot \vec{v} = \left\Vert \vec{u} \right\Vert \times \left\Vert \vec{v} \right\Vert \times \cos(\theta)\]
    </div>
    <p>O√π :</p>
    <ul>
        <li>\(\left\Vert \vec{u} \right\Vert\) et \(\left\Vert \vec{v} \right\Vert\) sont les <strong>normes</strong> (longueurs) des vecteurs.</li>
        <li>\(\theta\) est l'<strong>angle</strong> non orient√© entre \(\vec{u}\) et \(\vec{v}\).</li>
    </ul>

    <h3>Caract√©risation de l'Orthogonalit√©</h3>
    <p>Le terme \(\cos(\theta)\) permet de d√©terminer l'orientation relative des vecteurs. Le cas le plus important est celui de l'orthogonalit√©.</p>
    <p><strong>Crit√®re d'orthogonalit√© :</strong></p>
    <div class="math-display">
        \[\vec{u} \perp \vec{v} \iff \vec{u} \cdot \vec{v} = 0\]
    </div>
    <div class="remarque">
        (Si les vecteurs sont perpendiculaires, \(\theta = 90^\circ\), donc \(\cos(\theta) = 0\)).
    </div>

    <h2>D√©finition Analytique (Dans un Rep√®re Orthonorm√©)</h2>

    <p>Dans un rep√®re orthonorm√© \((O; \vec{i}, \vec{j})\), si les coordonn√©es des vecteurs sont :</p>
    <div class="math-display">
        \[\vec{u} \begin{pmatrix} x \\ y \end{pmatrix} \quad \text{et} \quad \vec{v} \begin{pmatrix} x' \\ y' \end{pmatrix}\]
    </div>
    <p>Le produit scalaire est donn√© par la formule :</p>
    <div class="math-display">
        \[\vec{u} \cdot \vec{v} = x x' + y y'\]
    </div>

    <h2>Lien Fondamental avec la Physique : Le Travail d'une Force</h2>

    <div class="canvas-container">
        <canvas id="canvas_cours_travail" width="500" height="200"></canvas>
    </div>

    <p>En physique, le produit scalaire sert √† calculer le <strong>travail</strong> \(W\) d'une force constante \(\vec{F}\) lors d'un d√©placement rectiligne \(\vec{AB}\).</p>
    <div class="math-display">
        \[W(\vec{F}) = \vec{F} \cdot \vec{AB}\]
    </div>
    <p>En utilisant la d√©finition g√©om√©trique :</p>
    <div class="math-display">
        \[W(\vec{F}) = \left\Vert \vec{F} \right\Vert \times \left\Vert \vec{AB} \right\Vert \times \cos(\theta)\]
    </div>
    <ul>
        <li>Si la force \(\vec{F}\) est <strong>perpendiculaire</strong> au d√©placement \(\vec{AB}\) (force normale, r√©action), alors \(W(\vec{F}) = 0\).</li>
        <li>Si la force \(\vec{F}\) est dans le <strong>sens du mouvement</strong>, \(\cos(\theta) > 0\), alors \(W(\vec{F}) > 0\) (<strong>travail moteur</strong>).</li>
        <li>Si la force \(\vec{F}\) est dans le <strong>sens inverse du mouvement</strong>, \(\cos(\theta) < 0\), alors \(W(\vec{F}) < 0\) (<strong>travail r√©sistant</strong>).</li>
    </ul>
    
    <h2>Propri√©t√©s Alg√©briques</h2>
    <p>Le produit scalaire v√©rifie les propri√©t√©s suivantes : Commutativit√© et Bilin√©arit√© (distributivit√©).</p>

    <h2>Application : Le Th√©or√®me d'Al-Kashi (Loi des cosinus)</h2>

    <div class="canvas-container">
        <canvas id="canvas_cours_alkashi" width="400" height="250"></canvas>
    </div>

    <p>Dans un triangle \(ABC\), si l'on note \(a\), \(b\), \(c\) les longueurs des c√¥t√©s oppos√©s aux sommets \(A\), \(B\), \(C\) respectivement, on a la relation :</p>
    <div class="math-display">
        \[c^2 = a^2 + b^2 - 2ab \cos(\widehat{C})\]
    </div>

    <hr>
    
    <h1 class="main-title" style="color:#28a745; border-bottom: 2px solid #28a745;">üöÄ Exercices Dynamiques</h1>
    
    <h2>1. D√©finition G√©om√©trique : L'Essence de l'Angle</h2>
    
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 2 : Calcul avec angles en radians</h3>
        <div class="document-analyse">
            <strong>Donn√©es :</strong> \(\left\Vert \vec{u} \right\Vert = \)<span id="u_norm_1_2"></span>, \(\left\Vert \vec{v} \right\Vert = \)<span id="v_norm_1_2"></span>.
            Angle \((\vec{u}, \vec{v}) = \)<span id="angle_val_1_2"></span>.
        </div>
        <p><strong>Question :</strong> Calculer la valeur exacte du produit scalaire \(\vec{u} \cdot \vec{v}\).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_1_2', generateEx1_2)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_1_2')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_1_2">
            <p><strong>Solution :</strong></p>
            <p>1. Analyse de l'angle : <span id="angle_analysis_1_2"></span></p>
            <p>2. Valeur du cosinus :</p>
            <div id="sol_cos_1_2" class="math-display"></div>
            <p>3. Calcul final :</p>
            <div id="sol_calc_1_2" class="math-display"></div>
        </div>
    </div>

    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 3 : Orthogonalit√© conditionnelle</h3>
        <div class="document-analyse">
            <strong>Document :</strong> \(\left\Vert \vec{u} \right\Vert = \)<span id="u_norm_1"></span>. On cherche \(\vec{v}\) avec \(\left\Vert \vec{v} \right\Vert = \)<span id="v_norm_1"></span> tel que <span id="vec_w_eq"></span> soit orthogonal √† \(\vec{v}\).
        </div>
        <p><strong>Question :</strong> D√©terminer l'angle \(\theta\) (en degr√©s).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_1_3', generateEx1_3)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_1_3')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_1_3">
            <p><strong>Solution :</strong></p>
            <p>Condition d'orthogonalit√© : \(\vec{u} \cdot \vec{v} + k||\vec{v}||^2 = 0\)</p>
            <div id="sol_math_1_3" class="math-display"></div>
            <p id="sol_txt_1_3"></p>
        </div>
    </div>

    <h2>2. D√©finition Analytique</h2>
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 3 : G√©om√©trie analytique</h3>
        <div class="document-analyse">
            <strong>Donn√©es :</strong> <span id="enonce_A_2_3"></span>, <span id="enonce_B_2_3"></span>, <span id="enonce_C_2_3"></span>. On sait que \(\vec{BC} \perp \vec{AB}\).
        </div>
        <p><strong>Question :</strong> Trouver l'ordonn√©e \(y_C\).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_2_3', generateEx2_3)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_2_3')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_2_3">
            <p><strong>Solution :</strong></p>
            <div id="sol_content_2_3"></div>
        </div>
    </div>

    <h2>3. Physique : Travail d'une Force</h2>
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 3 : Analyse de donn√©es</h3>
        <div class="document-analyse">
            <p>Tableau des efforts de frottement :</p>
            <table class="data-table">
                <thead><tr><th>Portion</th><th>Distance \(d\) (m)</th><th>Effort \(\left\Vert \vec{F}_f \right\Vert\) (N)</th></tr></thead>
                <tbody>
                    <tr><td>A vers B (m√©tal)</td><td><span id="dAB_3"></span></td><td><span id="FfAB_3"></span></td></tr>
                    <tr><td>B vers C (bois)</td><td><span id="dBC_3"></span></td><td><span id="FfBC_3"></span></td></tr>
                </tbody>
            </table>
        </div>
        <p><strong>Question :</strong> Calculer le travail total \(W_{\text{frottement}}\) (A vers C).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_3_3', generateEx3_3)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_3_3')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_3_3">
            <p><strong>Solution :</strong></p>
            <div id="sol_math_3_3" class="math-display"></div>
            <p id="sol_txt_3_3"></p>
        </div>
    </div>
    
    <h2>4. Propri√©t√©s Alg√©briques</h2>
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 2 : Carr√© scalaire</h3>
        <p><strong>Question :</strong> \(\left\Vert \vec{u} \right\Vert = \)<span id="u_norm_4"></span>, \(\left\Vert \vec{v} \right\Vert = \)<span id="v_norm_4"></span>, \(\vec{u} \cdot \vec{v} = \)<span id="u_dot_v_4"></span>. Calculer \(\left\Vert \vec{u} + \vec{v} \right\Vert\).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_4_2', generateEx4_2)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_4_2')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_4_2">
            <p><strong>Solution :</strong></p>
            <div id="sol_math_4_2" class="math-display"></div>
            <p id="sol_txt_4_2"></p>
        </div>
    </div>

    <h2>5. Application : Le Th√©or√®me d'Al-Kashi</h2>
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 3 : Lecture de graphique et application</h3>
        <div class="document-analyse">
            <strong>Sch√©ma de l'√©querre OAB (g√©n√©r√© dynamiquement) :</strong>
            <p>Dimensions : \(OA = \)<span id="OA_5"></span> mm, \(OB = \)<span id="OB_5"></span> mm, \(\widehat{AOB} = \)<span id="AOB_5"></span>\(^\circ\).</p>
            <div class="canvas-container">
                <canvas id="canvas_ex5" width="400" height="300"></canvas>
            </div>
        </div>
        <p><strong>Question :</strong> D√©terminer la longueur \(AB\) (en mm) et l'angle \(\widehat{OAB}\) (en degr√©s).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_5_3', generateEx5_3)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_5_3')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_5_3">
            <p><strong>Solution :</strong></p>
            <ol>
                <li><strong>Longueur \(AB\) (Al-Kashi) :</strong>
                    <div id="sol_math_5_3_a" class="math-display"></div>
                </li>
                <li><strong>Angle \(\widehat{OAB}\) (R√©utilisation d'Al-Kashi) :</strong>
                    <div id="sol_math_5_3_b" class="math-display"></div>
                    <p id="sol_txt_5_3_b"></p>
                </li>
            </ol>
        </div>
    </div>
    
    <h2>6. Exercices de Synth√®se : Double Expression</h2>
    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 2 : D√©terminer un angle via les coordonn√©es</h3>
        <div class="document-analyse">
            <strong>Donn√©es :</strong> Dans un rep√®re orthonorm√©, on donne les vecteurs <span id="enonce_u_6_1"></span> et <span id="enonce_v_6_1"></span>.
        </div>
        <p><strong>Question :</strong> D√©terminer \(\cos(\theta)\) puis \(\theta\).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_6_1', generateEx6_1)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_6_1')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_6_1">
            <p><strong>Solution :</strong></p>
            <div id="sol_content_6_1"></div>
        </div>
    </div>

    <div class="exercice-bloc">
        <h3 class="niveau-titre">Niveau 3 : Retrouver une coordonn√©e</h3>
        <div class="document-analyse">
            <strong>Donn√©es :</strong> <span id="enonce_u_6_2"></span>, <span id="enonce_v_6_2"></span>.
            <div id="enonce_suite_6_2" style="margin-top:5px;"></div>
        </div>
        <p><strong>Question :</strong> D√©terminer \(y_v\).</p>
        
        <button class="btn-action btn-reset-ex" onclick="resetExercise('sol_ex_6_2', generateEx6_2)">üîÑ Nouvelles valeurs</button>
        <button class="btn-action btn-solution" onclick="toggleSolution('sol_ex_6_2')">Afficher la Solution</button>
        
        <div class="solution-bloc" id="sol_ex_6_2">
            <p><strong>Solution :</strong></p>
            <div id="sol_content_6_2"></div>
        </div>
    </div>

    <div class="footer-actions">
        <button id="copyright-btn" class="btn-action">‚öñÔ∏è Droits d'Auteur</button>
    </div>

    <div id="copyrightModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>‚öñÔ∏è Droits d'Auteur et Licence d'Utilisation</h2>
            <p><b>Auteur : Yann Merdy (yann.merdy@gmail.com)</b> - Novembre 2025</p>
            <hr>
            <h3>Licence d'Utilisation Non Commerciale</h3>
            <p>Ce code HTML/CSS/JavaScript ainsi que le contenu g√©n√©r√© par l'application ("Cours et Exercices Dynamiques : Le Produit Scalaire") sont la propri√©t√© intellectuelle exclusive de l'auteur, Yann Merdy.</p>
            
            <h4>Conditions :</h4>
            <ul>
                <li><b>Utilisation Priv√©e et √âducative (Autoris√©e) :</b> Vous √™tes autoris√©.e √† utiliser, copier, modifier et distribuer ce code et son contenu <b>uniquement</b> √† des fins <b>personnelles, √©ducatives et non lucratives</b>.</li>
                <li><b>Utilisation Commerciale (Interdite) :</b> Toute utilisation, distribution, int√©gration ou reproduction du code ou du contenu (total ou partiel) √† des fins <b>commerciales, lucratives ou professionnelles</b> est <b>strictement interdite</b> sans un accord √©crit pr√©alable et explicite de l'auteur.</li>
                <li><b>Attribution :</b> Toute reproduction ou modification doit conserver la mention de l'auteur originale (Yann Merdy) et la pr√©sente notice de droits d'auteur.</li>
            </ul>
            <p style="margin-top: 20px; font-style: italic;">Pour toute demande d'utilisation commerciale ou de licence sp√©cifique, veuillez contacter l'auteur √† l'adresse indiqu√©e ci-dessus.</p>
        </div>
    </div>

    <script>
        // --- UTILITAIRES ---
        // Fonction de formatage pour mettre les nombres n√©gatifs entre parenth√®ses
        function fmt(n) { return n < 0 ? "(" + n + ")" : n; }
        
        function getRandomInt(min, max) { 
            return Math.floor(Math.random() * (max - min + 1)) + min; 
        }

        // --- MOTEUR GRAPHIQUE ---
        
        function drawArrow(ctx, fromx, fromy, tox, toy, color = "#007bff", label = "") {
            const headlen = 10; 
            const angle = Math.atan2(toy - fromy, tox - fromx);
            
            ctx.beginPath();
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
            ctx.lineTo(tox, toy);
            ctx.fillStyle = color;
            ctx.fill();

            if(label) {
                ctx.fillStyle = color;
                ctx.font = "bold 14px Arial";
                ctx.fillText(label, tox + 5, toy - 5);
            }
        }

        function drawAngle(ctx, x, y, radius, startAngle, endAngle, label = "") {
            ctx.beginPath();
            ctx.arc(x, y, radius, startAngle, endAngle);
            ctx.strokeStyle = "#28a745";
            ctx.lineWidth = 1.5;
            ctx.stroke();
            if(label) {
                let midAngle = startAngle + (endAngle - startAngle)/2;
                ctx.fillStyle = "#28a745";
                ctx.font = "italic 14px Arial";
                ctx.fillText(label, x + (radius+15)*Math.cos(midAngle), y + (radius+15)*Math.sin(midAngle));
            }
        }

        function drawCourseGeo() {
            const canvas = document.getElementById('canvas_cours_geo');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,canvas.width, canvas.height);
            const Ox = 50, Oy = 150;
            drawArrow(ctx, Ox, Oy, Ox + 120, Oy, "#007bff", "u");
            const angleV = -40 * Math.PI / 180;
            drawArrow(ctx, Ox, Oy, Ox + 100*Math.cos(angleV), Oy + 100*Math.sin(angleV), "#dc3545", "v");
            drawAngle(ctx, Ox, Oy, 40, angleV, 0, "Œ∏");
            ctx.fillStyle = "black"; ctx.fillText("O", Ox-15, Oy+5);
        }

        function drawCourseWork() {
            const canvas = document.getElementById('canvas_cours_travail');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.beginPath(); ctx.moveTo(10, 150); ctx.lineTo(490, 150); ctx.strokeStyle = "#333"; ctx.lineWidth = 1; ctx.stroke();
            const bx = 50, by = 110, bw = 60, bh = 40;
            ctx.fillStyle = "#e9ecef"; ctx.fillRect(bx, by, bw, bh); ctx.strokeRect(bx, by, bw, bh);
            ctx.fillStyle = "#333"; ctx.fillText("m", bx+25, by+25);
            drawArrow(ctx, bx+bw, by+bh, bx+bw+150, by+bh, "#28a745", "AB (d√©placement)");
            const cx = bx + bw/2; const cy = by + bh/2; const fLen = 80; const angleF = -30 * Math.PI / 180;
            drawArrow(ctx, cx, cy, cx + fLen*Math.cos(angleF), cy + fLen*Math.sin(angleF), "#d63384", "F");
            ctx.setLineDash([5, 3]); ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + 60, cy); ctx.stroke(); ctx.setLineDash([]);
            drawAngle(ctx, cx, cy, 30, angleF, 0, "Œ∏");
        }

        function drawCourseAlKashi() {
            const canvas = document.getElementById('canvas_cours_alkashi');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,canvas.width, canvas.height);
            const Ax = 50, Ay = 200; const Bx = 300, By = 200; const Cx = 200, Cy = 50;
            ctx.beginPath(); ctx.moveTo(Ax, Ay); ctx.lineTo(Bx, By); ctx.lineTo(Cx, Cy); ctx.closePath();
            ctx.strokeStyle = "#333"; ctx.lineWidth = 2; ctx.stroke();
            ctx.fillStyle = "black"; ctx.font = "bold 14px Arial"; ctx.fillText("A", Ax-15, Ay+5); ctx.fillText("B", Bx+5, By+5); ctx.fillText("C", Cx-5, Cy-10);
            ctx.fillStyle = "#007bff"; ctx.fillText("c (AB)", (Ax+Bx)/2, Ay+20); ctx.fillText("b (AC)", (Ax+Cx)/2 - 20, (Ay+Cy)/2); ctx.fillText("a (BC)", (Bx+Cx)/2 + 10, (By+Cy)/2);
            const angCA = Math.atan2(Ay-Cy, Ax-Cx); const angCB = Math.atan2(By-Cy, Bx-Cx);
            drawAngle(ctx, Cx, Cy, 30, angCB, angCA, "C");
        }

        function drawEx5(OA, OB, degAngle) {
            const canvas = document.getElementById('canvas_ex5');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,canvas.width, canvas.height);
            const angleRad = -degAngle * Math.PI / 180; const scale = 1.5;
            const Ox = 50; const Oy = 250;
            const Ax = Ox + OA * scale; const Ay = Oy;
            const Bx = Ox + OB * scale * Math.cos(angleRad); const By = Oy + OB * scale * Math.sin(angleRad);
            ctx.beginPath(); ctx.moveTo(Ox, Oy); ctx.lineTo(Ax, Ay); ctx.lineTo(Bx, By); ctx.lineTo(Ox, Oy);
            ctx.strokeStyle = "#333"; ctx.lineWidth = 2; ctx.stroke();
            ctx.fillStyle = "red"; ctx.beginPath(); ctx.arc(Ox, Oy, 3, 0, 2*Math.PI); ctx.fill(); ctx.beginPath(); ctx.arc(Ax, Ay, 3, 0, 2*Math.PI); ctx.fill(); ctx.beginPath(); ctx.arc(Bx, By, 3, 0, 2*Math.PI); ctx.fill();
            ctx.fillStyle = "black"; ctx.font = "bold 14px Arial"; ctx.fillText("O", Ox-15, Oy+5); ctx.fillText("A", Ax+5, Ay+5); ctx.fillText("B", Bx, By-10);
            ctx.fillStyle = "#007bff"; ctx.fillText(OA + " mm", (Ox+Ax)/2 - 10, Oy+20); ctx.fillText(OB + " mm", (Ox+Bx)/2 - 30, (Oy+By)/2);
            drawAngle(ctx, Ox, Oy, 30, angleRad, 0, degAngle + "¬∞");
        }

        // --- LOGIQUE METIER ---

        function resetExercise(solutionId, generatorFunction) {
            document.getElementById(solutionId).style.display = 'none';
            generatorFunction();
            MathJax.typeset();
        }

        // Ex 1.2
        function generateEx1_2() {
            let u = getRandomInt(2, 8); let v = getRandomInt(2, 8);
            document.getElementById('u_norm_1_2').innerText = u; document.getElementById('v_norm_1_2').innerText = v;
            const types = ['simple', 'associe', 'grand']; const type = types[getRandomInt(0, 2)];
            let baseAngles = [{ num: 1, den: 6, cosTex: "\\frac{\\sqrt{3}}{2}", val: Math.sqrt(3)/2 }, { num: 1, den: 4, cosTex: "\\frac{\\sqrt{2}}{2}", val: Math.sqrt(2)/2 }, { num: 1, den: 3, cosTex: "\\frac{1}{2}", val: 0.5 }, { num: 1, den: 2, cosTex: "0", val: 0 }];
            let base = baseAngles[getRandomInt(0, 3)]; 
            let finalNum, finalAngleTex, analysisText, cosCalcTex;
            if (type === 'simple') { finalNum = base.num; finalAngleTex = `\\frac{\\pi}{${base.den}}`; analysisText = "C'est un angle remarquable."; cosCalcTex = `\\cos\\left(${finalAngleTex}\\right) = ${base.cosTex}`; } 
            else if (type === 'associe') { if (Math.random() > 0.5) { finalNum = base.den - base.num; finalAngleTex = `\\frac{${finalNum}\\pi}{${base.den}}`; analysisText = `Angle suppl√©mentaire (pi - x).`; cosCalcTex = `\\cos\\left(\\pi - \\frac{\\pi}{${base.den}}\\right) = -${base.cosTex}`; base.val = -base.val; base.cosTex = "-" + base.cosTex; } else { finalNum = -base.num; finalAngleTex = `-\\frac{\\pi}{${base.den}}`; analysisText = `Angle n√©gatif (-x).`; cosCalcTex = `\\cos(-x) = \\cos(x) = ${base.cosTex}`; } } 
            else { let tours = getRandomInt(2, 5) * 2; finalNum = tours * base.den + base.num; finalAngleTex = `\\frac{${finalNum}\\pi}{${base.den}}`; analysisText = `Angle > 2pi.`; cosCalcTex = `\\cos\\left(${finalAngleTex}\\right) = ${base.cosTex}`; }
            document.getElementById('angle_val_1_2').innerHTML = `\\(${finalAngleTex}\\)`;
            document.getElementById('angle_analysis_1_2').innerHTML = analysisText;
            document.getElementById('sol_cos_1_2').innerHTML = `\\[${cosCalcTex}\\]`;
            let prod = u * v; let finalResTex = "";
            if (Math.abs(base.val) === 0.5) { finalResTex = prod * base.val; } else if (base.val === 0) { finalResTex = "0"; } else { let sign = (base.val < 0) ? "-" : ""; let rootPart = base.cosTex.replace("-", "").replace("\\frac{", "").replace("}{2}", ""); let simplifiedCoeff = prod / 2; if (Number.isInteger(simplifiedCoeff)) { finalResTex = `${sign}${simplifiedCoeff}${rootPart}`; } else { finalResTex = `${sign}\\frac{${prod}}{2}${rootPart}`; } }
            // Application de fmt() sur u et v pour coh√©rence, m√™me s'ils sont positifs ici
            document.getElementById('sol_calc_1_2').innerHTML = `\\[\\vec{u} \\cdot \\vec{v} = ${fmt(u)} \\times ${fmt(v)} \\times \\left( ${base.cosTex} \\right) = ${finalResTex}\\]`;
        }

        // Ex 1.3
        function generateEx1_3() {
            let k; do { k = getRandomInt(-5, 5); } while (k === 0);
            let v = getRandomInt(3, 8); let u = Math.abs(k) * v + getRandomInt(2, 10);
            document.getElementById('u_norm_1').innerText = u; document.getElementById('v_norm_1').innerText = v;
            let sign = (k < 0) ? "-" : "+"; let abs_k = Math.abs(k);
            document.getElementById('vec_w_eq').innerHTML = "\\(\\vec{w} = \\vec{u} " + sign + " " + abs_k + "\\vec{v}\\)";
            let num = -k * v * v; let den = u * v; let cos_theta = num / den; let angle = Math.acos(cos_theta) * (180 / Math.PI);
            
            // Calcul de -k pour l'affichage correct (-2 ou -(-2))
            let minus_k = -k;
            document.getElementById('sol_math_1_3').innerHTML = "\\[\\cos(\\theta) = \\frac{" + fmt(minus_k) + " \\times " + fmt(v) + "^2}{" + fmt(u) + " \\times " + fmt(v) + "} = \\frac{" + fmt(minus_k) + " \\times " + fmt(v) + "}{" + fmt(u) + "} \\approx " + cos_theta.toFixed(3) + "\\]";
            document.getElementById('sol_txt_1_3').innerHTML = "L'angle est \\(\\theta \\approx " + angle.toFixed(1) + "^\\circ\\).";
        }

        // Ex 2.3
        function generateEx2_3() {
            let Ax=getRandomInt(-5,5), Ay=getRandomInt(-5,5), Bx=getRandomInt(-5,5), By=getRandomInt(-5,5), Cx=getRandomInt(-5,5);
            if(Bx===Ax && By===Ay) Bx+=2; let ux=Bx-Ax, uy=By-Ay; if(uy===0){uy=1;By+=1;}
            let Cy = By - (Cx - Bx) * ux / uy;
            
            document.getElementById('enonce_A_2_3').innerHTML = "\\(A(" + Ax + "; " + Ay + ")\\)";
            document.getElementById('enonce_B_2_3').innerHTML = "\\(B(" + Bx + "; " + By + ")\\)";
            document.getElementById('enonce_C_2_3').innerHTML = "\\(C(" + Cx + "; y_C)\\)";

            let unorm = Math.sqrt(ux*ux + uy*uy), BCx = Cx-Bx, BCy = Cy-By, BCnorm = Math.sqrt(BCx*BCx+BCy*BCy);
            
            // Formatage strict avec fmt()
            let html = "<ol><li>\\(\\vec{u} = \\begin{pmatrix} " + ux + " \\\\ " + uy + " \\end{pmatrix}\\). Norme : \\(\\approx " + unorm.toFixed(2) + "\\).</li>";
            html += "<li>Condition d'orthogonalit√© : \\(\\vec{BC} \\cdot \\vec{u} = 0\\).<br>";
            html += "\\(" + fmt(BCx) + " \\times " + fmt(ux) + " + (y_C - " + fmt(By) + ") \\times " + fmt(uy) + " = 0\\).<br>";
            html += "Soit \\(y_C = " + Cy.toFixed(2) + "\\).</li>";
            html += "<li>Norme BC : \\(\\approx " + BCnorm.toFixed(2) + "\\).</li></ol>";
            document.getElementById('sol_content_2_3').innerHTML = html;
        }

        // Ex 3.3
        function generateEx3_3() {
            let dAB=getRandomInt(5,20), dBC=getRandomInt(5,20), FfAB=getRandomInt(10,50), FfBC=getRandomInt(10,50);
            document.getElementById('dAB_3').innerText=dAB; document.getElementById('FfAB_3').innerText=FfAB;
            document.getElementById('dBC_3').innerText=dBC; document.getElementById('FfBC_3').innerText=FfBC;
            let WAB = FfAB*dAB*(-1), WBC=FfBC*dBC*(-1), Wtot=WAB+WBC;
            
            // Formatage strict pour WAB et WBC (qui sont n√©gatifs)
            document.getElementById('sol_math_3_3').innerHTML = "\\[W_{AB}=" + fmt(WAB) + " \\text{ J}, \\quad W_{BC}=" + fmt(WBC) + " \\text{ J}\\]";
            document.getElementById('sol_txt_3_3').innerHTML = "Total : \\(" + fmt(WAB) + " + " + fmt(WBC) + " = " + Wtot + "\\) J.";
        }

        // Ex 4.2
        function generateEx4_2() {
            let u=getRandomInt(4,10), v=getRandomInt(4,10), dot=getRandomInt(-u*v+1, u*v);
            document.getElementById('u_norm_4').innerText=u; document.getElementById('v_norm_4').innerText=v; document.getElementById('u_dot_v_4').innerText=dot;
            let nsq = u*u + v*v + 2*dot;
            // Formatage strict
            document.getElementById('sol_math_4_2').innerHTML = "\\[\\|\\vec{u}+\\vec{v}\\|^2 = " + u + "^2 + " + v + "^2 + 2 \\times " + fmt(dot) + " = " + nsq + "\\]";
            document.getElementById('sol_txt_4_2').innerHTML = "Donc \\(\\approx " + Math.sqrt(nsq).toFixed(2) + "\\).";
        }

        // Ex 5.3
        function generateEx5_3() {
            let OA=getRandomInt(80,150), OB=getRandomInt(70,120), AOB=getRandomInt(30,150);
            document.getElementById('OA_5').innerText=OA; document.getElementById('OB_5').innerText=OB; document.getElementById('AOB_5').innerText=AOB;
            drawEx5(OA, OB, AOB);
            let rad=AOB*Math.PI/180, ABsq=(OA*OA+OB*OB-2*OA*OB*Math.cos(rad)).toFixed(2), AB=Math.sqrt(ABsq).toFixed(2);
            let cosOAB=((OA*OA+parseFloat(ABsq)-OB*OB)/(2*OA*AB)).toFixed(3), angOAB=(Math.acos(cosOAB)*180/Math.PI).toFixed(1);
            
            // cos(AOB) peut √™tre n√©gatif, donc on utilise fmt() pour le terme cosinus calcul√© ou on affiche le cos dans la formule
            document.getElementById('sol_math_5_3_a').innerHTML = "\\[AB^2 \\approx " + ABsq + " \\implies AB \\approx " + AB + "\\]";
            document.getElementById('sol_math_5_3_b').innerHTML = "\\[\\cos(\\widehat{OAB}) \\approx " + fmt(parseFloat(cosOAB)) + "\\]";
            document.getElementById('sol_txt_5_3_b').innerHTML = "\\[\\widehat{OAB} \\approx " + angOAB + "^\\circ\\]";
        }

        // Ex 6.1
        function generateEx6_1() {
            let ux, uy, vx, vy;
            do { ux = getRandomInt(-5, 5); uy = getRandomInt(-5, 5); } while(ux===0 && uy===0);
            do { vx = getRandomInt(-5, 5); vy = getRandomInt(-5, 5); } while(vx===0 && vy===0);
            
            let texU = "\\(\\vec{u} \\begin{pmatrix} " + ux + " \\\\\\\\ " + uy + " \\end{pmatrix}\\)";
            let texV = "\\(\\vec{v} \\begin{pmatrix} " + vx + " \\\\\\\\ " + vy + " \\end{pmatrix}\\)";
            document.getElementById('enonce_u_6_1').innerHTML = texU;
            document.getElementById('enonce_v_6_1').innerHTML = texV;

            let dotAnalytic = ux * vx + uy * vy;
            let normU = Math.sqrt(ux*ux + uy*uy);
            let normV = Math.sqrt(vx*vx + vy*vy);
            let cosTheta = dotAnalytic / (normU * normV);
            let thetaDeg = Math.acos(Math.max(-1, Math.min(1, cosTheta))) * (180 / Math.PI);
            
            let html = "<ol>";
            html += "<li><strong>Expression Analytique :</strong> \\(" + fmt(ux) + " \\times " + fmt(vx) + " + " + fmt(uy) + " \\times " + fmt(vy) + " = " + dotAnalytic + "\\).</li>";
            html += "<li><strong>Normes :</strong> \\(\\sqrt{" + (ux*ux+uy*uy) + "}\\) et \\(\\sqrt{" + (vx*vx+vy*vy) + "}\\).</li>";
            html += "<li><strong>R√©sultat :</strong> \\(\\cos(\\theta) \\approx " + fmt(parseFloat(cosTheta.toFixed(4))) + "\\). Angle \\(\\theta \\approx " + thetaDeg.toFixed(1) + "^\\circ\\).</li>";
            html += "</ol>";
            document.getElementById('sol_content_6_1').innerHTML = html;
        }

        // Ex 6.2
        function generateEx6_2() {
            let ux, uy, vx, vy;
            do { ux = getRandomInt(-4, 4); uy = getRandomInt(-4, 4); } while(ux===0 && uy===0);
            do { vx = getRandomInt(-4, 4); vy = getRandomInt(-4, 4); } while((vx===0 && vy===0) || uy===0); 
            
            let texU = "\\(\\vec{u} \\begin{pmatrix} " + ux + " \\\\\\\\ " + uy + " \\end{pmatrix}\\)";
            let texV = "\\(\\vec{v} \\begin{pmatrix} " + vx + " \\\\\\\\ y_v \\end{pmatrix}\\)";
            document.getElementById('enonce_u_6_2').innerHTML = texU;
            document.getElementById('enonce_v_6_2').innerHTML = texV;

            let dot = ux*vx + uy*vy; 
            let nu = Math.sqrt(ux*ux + uy*uy);
            let nv = Math.sqrt(vx*vx + vy*vy);
            let cosT = dot / (nu * nv); 
            
            let texSuite = "Norme \\(\\left\\Vert \\vec{v} \\right\\Vert = \\sqrt{" + (vx*vx+vy*vy) + "}\\) et \\(\\cos(\\theta) \\approx " + fmt(parseFloat(cosT.toFixed(3))) + "\\).";
            document.getElementById('enonce_suite_6_2').innerHTML = texSuite;
            
            let geo_approx = nu * nv * parseFloat(cosT.toFixed(3)); 
            let html = "<ol>";
            html += "<li><strong>Produit Scalaire (G√©om√©trique) :</strong><br>Calcul approximatif : \\(" + nu.toFixed(2) + " \\times " + nv.toFixed(2) + " \\times " + fmt(parseFloat(cosT.toFixed(3))) + " \\approx " + geo_approx.toFixed(2) + "\\).<br>";
            html += "<em>Note p√©dagogique : On arrondit √† <strong>" + dot + "</strong>.</em></li>";
            html += "<li><strong>Produit Scalaire (Analytique) :</strong> \\(" + fmt(ux) + " \\times " + fmt(vx) + " + " + fmt(uy) + " \\times y_v = " + (ux*vx) + " + " + fmt(uy) + "y_v\\).</li>";
            let produit_ux_vx = ux*vx;
            html += "<li><strong>R√©solution :</strong> \\(y_v = (" + dot + " - " + fmt(produit_ux_vx) + ") / " + fmt(uy) + " = " + vy + "\\).</li>";
            html += "</ol>";
            document.getElementById('sol_content_6_2').innerHTML = html;
        }

        function toggleSolution(solutionId) {
            const div = document.getElementById(solutionId);
            div.style.display = (div.style.display === 'none' || div.style.display === '') ? 'block' : 'none';
        }

        // --- GESTION MODALE DROITS D'AUTEUR ---
        document.addEventListener('DOMContentLoaded', () => {
            const copyrightBtn = document.getElementById('copyright-btn');
            const copyrightModal = document.getElementById('copyrightModal');
            const closeBtn = document.querySelector('.close-btn');

            function openModal() {
                copyrightModal.style.display = "block";
            }
            function closeModal() {
                copyrightModal.style.display = "none";
            }

            copyrightBtn.addEventListener('click', openModal);
            closeBtn.addEventListener('click', closeModal);
            window.addEventListener('click', (event) => {
                if (event.target === copyrightModal) {
                    closeModal();
                }
            });
        });

        function generateAllExercises() {
            document.querySelectorAll('.solution-bloc').forEach(b => b.style.display = 'none');
            // Dessins statiques
            drawCourseGeo();
            drawCourseWork();
            drawCourseAlKashi();
            // Exos
            generateEx1_2(); generateEx1_3(); generateEx2_3(); 
            generateEx3_3(); generateEx4_2(); generateEx5_3();
            generateEx6_1(); generateEx6_2();
            MathJax.typeset();
        }

        window.onload = generateAllExercises;
    </script>
</body>
</html>
